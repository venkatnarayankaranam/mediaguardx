# External Integrations

**Analysis Date:** 2026-02-06

## APIs & External Services

**Backend API (Self-hosted FastAPI):**
- The backend IS the API; no third-party API services are consumed
- API prefix: `/api` with sub-routers:
  - `/api/auth` - Authentication (`backend/routes/auth.py`)
  - `/api/detect` - Deepfake detection (`backend/routes/detection.py`)
  - `/api/history` - Detection history (`backend/routes/history.py`)
  - `/api/report` - PDF report generation (`backend/routes/reports.py`)
  - `/api/admin` - Admin dashboard data (`backend/routes/admin.py`)
  - `/api/live` - Live camera monitoring placeholder (`backend/routes/live.py`)
- Health check: `GET /health`
- Root info: `GET /`
- OpenAPI docs: auto-generated by FastAPI at `/docs` and `/redoc`

**Frontend-to-Backend Communication:**
- HTTP client: Axios ^1.13.2 (`mediaguardx/src/services/api.ts`)
- Base URL: `VITE_API_URL` env var or `http://localhost:8000/api`
- Auth: Bearer token via request interceptor
- Auto-redirect to `/login` on 401 responses via response interceptor
- File uploads: `multipart/form-data` via FormData API

## Data Storage

**Database:**
- MongoDB (any version compatible with Motor 3.3.2 / PyMongo 4.6.0)
  - Connection: `MONGO_URL` environment variable
  - Client: Motor (async) `AsyncIOMotorClient` (`backend/database.py`)
  - Database name: derived from connection string via `client.get_database()`
  - Collections used:
    - `users` - User accounts (`backend/models/user.py`)
    - `detections` - Detection records (`backend/models/detection.py`)
    - `reports` - PDF report metadata (`backend/models/report.py`)
    - `activity_logs` - Audit trail (`backend/models/activity_log.py`)
  - No migration framework; schema defined via Pydantic models
  - No indexes explicitly created in code (relies on MongoDB defaults + `_id`)

**File Storage:**
- Local filesystem only
  - Uploads: `{upload_dir}/{media_type}/{user_id}/` (`backend/utils/file_handler.py`)
  - Reports (PDF): `{reports_dir}/report_{report_id}.pdf` (`backend/services/pdf_generator.py`)
  - Heatmaps (PNG): `{heatmaps_dir}/heatmap_{detection_id}.png` (`backend/services/model_engine.py`)
  - ML model checkpoint: `backend/models/deepfake_detector.pth`
  - Directories auto-created on startup/use via `os.makedirs(..., exist_ok=True)`
  - Default dirs: `uploads/`, `reports/`, `heatmaps/` (relative to backend working directory)

**Client-Side Storage:**
- `localStorage` via Zustand `persist` middleware
  - `auth-storage` key - User session, JWT token (`mediaguardx/src/store/authStore.ts`)
  - `detection-storage` key - Detection result history cache (`mediaguardx/src/store/detectionStore.ts`)

**Caching:**
- None (no Redis, Memcached, or in-memory caching layer)

## Authentication & Identity

**Auth Provider:**
- Custom JWT-based authentication (no third-party auth provider)
  - Token creation: `python-jose` with HS256 algorithm (`backend/utils/auth.py`)
  - Password hashing: `passlib` with bcrypt scheme (`backend/utils/auth.py`)
  - Token expiry: 24 hours (configurable via `jwt_access_token_expire_minutes`)
  - Token payload: `{"sub": user_id, "exp": expiry_timestamp}`
  - Middleware: `HTTPBearer` security scheme (`backend/middleware/auth.py`)

**Role-Based Access Control:**
- Three roles: `user`, `investigator`, `admin` (`backend/models/user.py`)
- Role enforcement via `require_role()` dependency factory (`backend/middleware/auth.py`)
- Convenience helpers: `require_admin`, `require_investigator`, `require_user`
- Frontend: `ProtectedRoute` component checks `isAuthenticated` and `requiredRole` (`mediaguardx/src/App.tsx`)

**Account Security:**
- Failed login attempt tracking with lockout (`max_failed_login_attempts`: 5, `account_lockout_minutes`: 30)
- Account locking/unlocking managed in auth middleware (`backend/middleware/auth.py`)

## Monitoring & Observability

**Error Tracking:**
- None (no Sentry, Datadog, or external error tracking)
- Custom error handler middleware catches exceptions and returns structured JSON (`backend/middleware/error_handler.py`)
- Exception types handled: `AppException`, `RequestValidationError`, `DuplicateKeyError`, generic `Exception`

**Logs:**
- Python `logging` module with basicConfig (`backend/main.py`)
- Format: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`
- Level: INFO
- Output: stdout/stderr (no log file rotation or external log aggregation)

**Activity Audit:**
- Activity logs written to MongoDB `activity_logs` collection (`backend/routes/detection.py`)
- Tracked: user_id, action, resource_type, resource_id, ip_address, user_agent, timestamp
- Currently only detection actions are logged

## CI/CD & Deployment

**Hosting:**
- Not configured (no deployment target specified)
- No Dockerfile, docker-compose.yml, Procfile, vercel.json, netlify.toml, or similar

**CI Pipeline:**
- None configured (no GitHub Actions, GitLab CI, or similar)

**Linting/Formatting:**
- No ESLint, Prettier, Biome, or Python linting tools configured
- TypeScript strict mode provides some code quality enforcement

## Environment Configuration

**Required env vars:**
- `JWT_SECRET` - Secret key for JWT token signing (critical security value)
- `MONGO_URL` - MongoDB connection string (e.g., `mongodb://localhost:27017/mediaguardx`)
- `VITE_API_URL` - Frontend API base URL (optional; defaults to `http://localhost:8000/api`)

**Optional env vars with defaults:**
- `JWT_ALGORITHM` - default `HS256`
- `JWT_ACCESS_TOKEN_EXPIRE_MINUTES` - default `1440` (24 hours)
- `PORT` - default `8000`
- `HOST` - default `0.0.0.0`
- `NODE_ENV` - default `development` (enables uvicorn reload)
- `FRONTEND_URL` - default `http://localhost:5173` (CORS origin)
- `MAX_FILE_SIZE_MB` - default `500`
- `UPLOAD_DIR` - default `uploads`
- `REPORTS_DIR` - default `reports`
- `HEATMAPS_DIR` - default `heatmaps`
- `RATE_LIMIT_PER_MINUTE` - default `60`

**Secrets location:**
- `.env` file in backend directory (loaded by pydantic-settings)
- No `.env` file committed to repository
- No `.env.example` file present

## Webhooks & Callbacks

**Incoming:**
- None

**Outgoing:**
- None

## Static File Serving

**Backend-served static files:**
- Heatmap images mounted at `/heatmaps/` via FastAPI `StaticFiles` (`backend/main.py`)
- Detection files served dynamically via `/api/detect/{detection_id}/file` endpoint (`backend/routes/detection.py`)
- Report PDFs served via report download endpoints (`backend/routes/reports.py`)

**Frontend static assets:**
- Vite builds to `dist/` directory
- Entry: `mediaguardx/index.html`
- No static asset CDN or proxy configured

## CORS Configuration

**Settings (`backend/main.py`):**
- Allowed origins: `settings.frontend_url`, `http://localhost:5173`, `http://localhost:3000`
- Credentials: allowed
- Methods: all (`*`)
- Headers: all (`*`)

## Rate Limiting

**Implementation:**
- `slowapi` 0.1.9 with `get_remote_address` key function (`backend/middleware/rate_limiter.py`)
- Configured at app level; per-route decorators not observed in current routes
- Rate limit setting: `rate_limit_per_minute` (default 60)

## Email (Placeholder)

**Status:** Not implemented
- SMTP configuration fields exist in settings (`backend/config.py`): `smtp_host`, `smtp_port`, `smtp_user`, `smtp_password`
- All default to `None`
- No email sending code exists in the codebase
- Forgot password flow exists in frontend (`mediaguardx/src/pages/ForgotPassword.tsx`) but backend email delivery is not wired

## ML Model Integration

**Model Loading:**
- Lazy-loaded on first detection request (`backend/services/model_engine.py`)
- Falls back to deterministic hash-based scoring if no model file or ML libs available
- Model file expected at: `backend/models/deepfake_detector.pth`
- GPU acceleration: auto-detected via `torch.cuda.is_available()`

**Dataset:**
- FaceForensics++ image samples present in `FaceForensics/` and `ffpp_images/` directories
- `ffpp_images/` contains `train/` and `val/` splits (ImageFolder layout)
- Dummy dataset generator available: `backend/ml/make_dummy_dataset.py`

---

*Integration audit: 2026-02-06*
